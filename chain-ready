nexec () {
        task=$1
        allocid=$2
        cmd=$3
        nomad alloc exec -i -t -task $task $allocid $cmd
}

nlsa () {
        chain=$1
        nomad job allocs $chain | sed 1d | grep --color -v stop | cut -d' ' -f1-3
}

job="${1-solana-devnet}"

allocs=$(nlsa $job | cut -d' ' -f1)

command="${2-/opt/tatum.io/ready.sh}"

for alloc in $allocs; do
    echo $alloc
    nomad alloc exec -i -t -task $job $alloc $command
    nomad alloc exec -i -t -task green-$job $alloc $command
done;
